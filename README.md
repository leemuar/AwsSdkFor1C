# ЯндексMQ SDK для 1С:Предприятия

Библиотека для работы с [брокером сообщений Яндекс Message Queue](https://yandex.cloud/ru/services/message-queue) из 1С:Предприятия. 
Позволяет разработчикам на платформе 1С:Предприятие создавать программы, взаимодействующие с облачным брокером сообщений ЯндексMQ (YMQ).

## Быстрый старт

```bsl
// для работы с ЯндексMQ обязательно требуются AccessKey и SecretKey.
// Это своеобразные логин и пароль для доступа к сервису.
// как их получить описано на https://yandex.cloud/ru/docs/iam/operations/sa/create-access-key
AccessKey = "...";
SecretKey = "...";
ЯндексMQ  = Обработки.ЯндексMQ.НовыйКлиент( AccessKey, SecretKey );

// создадим новую очередь
АдресОчереди = ЯндексMQ.CreateQueue( "queue-name" );

// положим сообщение в очередь
ЯндексMQ.SendMessage( АдресОчереди, "Это текст сообщения" );

// получим сообщения из очереди
Сообщения = ЯндексMQ.RecieveMessage( АдресОчереди );

// обработаем все полученные сообщения
Для Каждого ДанныеСообщения Из Сообщения Цикл
    // КакТоОбработать( ДанныеСообщения.Body );
    // успешно обработанные - удалим из очереди
    ЯндексMQ.DeleteMessage( АдресОчереди, ДанныеСообщения.ReceiptHandle );
КонецЦикла;
```
## Как установить

Скачайте в разделе "Releases" файл конфигурации (.cf) и перенесите из него в свою конфигурацию обработку "ЯндексMQ".
Рекомендуется переносить обработку напрямую из файла конфигурации, не сохранять ее как внешнюю : обработка конфигурации содержит модуль менеджера с удобный методом-фабрикой, при сохранении обработки как внешней этот модуль менеджера теряется

## Как использовать

Библиотека использует объектный подход к своей работе. Для начала работы необходимо получит объект библиотеки. В модуле менеджера обработки есть готовый метод-фабрика, создающий этот объект:

```bsl
// для работы с ЯндексMQ обязательно требуются AccessKey и SecretKey.
// Это своеобразные логин и пароль для доступа к сервису.
// как их получить описано на https://yandex.cloud/ru/docs/iam/operations/sa/create-access-key
AccessKey = "...";
SecretKey = "...";
ЯндексMQ  = Обработки.ЯндексMQ.НовыйКлиент( AccessKey, SecretKey );
```

После создания объекта клиента можно вызывать его методы, выполняющие запросы к сервису очередей:

```bsl
АдресОчереди = ЯндексMQ.CreateQueue( "queue-name" );
// положим сообщения в очередь
ЯндексMQ.SendMessage( АдресОчереди, "Это текст сообщения" );
```

Библиотека предлагает 2 набора методов: простые и детальные. Простые стараются сделать максимум за вас: выполнить запрос и вернуть результат в удобном виде. Например, DeleteQueue() вернет Истина в случае успешного удаления очереди, и Ложь - в случае каких-то ошибок. Или CreateQueue() возвращает URL созданной очереди в случае успеха или Неопределено - при ошибке. Однако простые методы не дают понимания что пошло не так в случае какой-то ошибки.

Когда вам нужно больше информации о результате запроса - используете методы, оканчивающиеся на Response - DeleteQueueResponse(), CreateQueueResponse() и т.п. Эти методы возвращают структуру с детальными данными результата запроса - код ответа http, тело запроса, заголовки http и т.п. Используя их можно детально понять что ответил сервис, залогировать данные в случае ошибок или описать более детальную обработку ответа самостоятельно:

```bsl
Ответ = DeleteQueueResponse( QueueUrl );
Если 200 <> Ответ.КодСостояния Тогда
    ЛогОшибка( Ответ.Заголовки, Ответ.Тело, Ответ.КодСостояния );
КонецЕсли;
```

Ни простые ни -Response методы не перехватывают исключения. Если при выполнении запроса будет выброшено исключение - методы не будут пытаться его перехватить. Всегда оборачивайте вызов методов в Попытку.
